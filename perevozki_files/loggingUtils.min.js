define("loggingUtils/bi/errors.json",[],function(){return{SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED:{errorCode:111020,severity:"warning",params:{p2:"pageId",p1:"hostname",p3:"url",p4:"responseStatusCode"}},ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED:{errorCode:111021,severity:"fatal",params:{p1:"pageId"}},UNHANDLED_LINK_TYPE_IN_DATA_FIXER:{errorCode:21067,severity:"fatal",params:{p1:"newLinkDataItem"}}}});define("loggingUtils/bi/services/wixBI",["lodash","coreUtils","experiment"],function(a,b,c){"use strict";var d=typeof window!=="undefined";var e=d&&window.queryUtil&&window.queryUtil.isParameterTrue("isEdited");var f={biUrl:"//frog.wixpress.com",adapter:"",params:{}};var g=function(){if(!d){return true}var a=[/bot/i,/Google Web Preview/i,/^Mozilla\/4\.0$/];var b=window.navigator.userAgent;for(var c=0;c<a.length;++c){if(a[c].test(b)){return true}}return false}();var h=g?a.noop:i;function i(a,c,d,e){var f=b.urlUtils.joinURL(a,c);if(d){f+="?"+d}if(!j(f,e)){(new window.Image).src=f}}function j(a,b){var c=false;if(b&&window.navigator&&window.navigator.sendBeacon){try{c=window.navigator.sendBeacon(a)}catch(a){}}return c}function k(b,c){var d=e&&c.adapter==="editor"?window.parent.mainLoaded:0;d=d||b.wixBiSession.initialTimestamp||b.wixBiSession.mainLoaded;return a.now()-d}function l(d,e){var g=a.get(d,["serviceTopology","biServerUrl"]);if(g){f.biUrl=g}c.isOpen("useBeacon");a.defaults(e,f);var i="useBeacon"in e?e.useBeacon:c.isOpen("useBeacon");var j=a.isString(e.queryString)?e.queryString:b.urlUtils.toQueryString(a.defaults(e.params,{ts:k(d,e)}));h(e.biUrl,e.adapter,j,i)}return{report:l}});define("loggingUtils/bi/services/googleAnalytics",["lodash","coreUtils"],function(a,b){"use strict";var c=200;function d(b,c,d){if(window._gaq){e()}else{requirejs(["https://stats.g.doubleclick.net/dc.js"],e,a.noop)}function e(){var e=window._gaq||[];window._gaq=e;a.forEach(c,function(a,c){var f=c===0?"":"t"+c+".";e.push([f+"_setAccount",a],[f+"_setAllowAnchor",true]);if(d){e.push([f+"_setCustomVar",1,"version",d.ver,1],[f+"_setCustomVar",2,"language",d.lng,1],[f+"_setCustomVar",3,"userType",d.userType,1])}e.push([f+"_trackPageview",b])})}}function e(b,c){if(a.isEmpty(b)){return}if(window.ga){c()}else{requirejs(["//www.google-analytics.com/analytics.js"],function(){window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)};window.ga.l=a.now();window.ga.q=window.ga.q||[];a.forEach(b,function(a){window.ga("create",a,"auto")});c()},a.noop)}}return{reportPageEvent:function(a,f,g,h){if(typeof window!=="undefined"){setTimeout(function(){if(a.isUsingUrlFormat(b.siteConstants.URL_FORMATS.SLASH)){e(g,function(){window.ga("send","pageview",{page:f})})}else{d(f,g,h)}},c)}},report:function(b){var c=a.tail(arguments);e(b,function(){window.ga.apply(window.ga,c)})}}});define("loggingUtils/bi/services/facebookRemarketing",["lodash","coreUtils"],function(a,b){"use strict";function c(a){if(window._fbq){return}var b=window._fbq||(window._fbq=[]);if(!b.loaded){var c=window.document.createElement("script");c.async=true;c.src="//connect.facebook.net/en_US/fbds.js";var d=window.document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d);b.loaded=true}b.push(["addPixelId",a]);window._fbq.push(["track","PixelInitialized",{}])}function d(a){var b,c,d;if(!window.fbq){b=window.fbq=function(){if(b.callMethod){b.callMethod.apply(b,arguments)}else{b.queue.push(arguments)}};if(!window._fbq){window._fbq=b}b.push=b;b.loaded=true;b.version="2.0";b.queue=[];c=window.document.createElement("script");c.async=true;c.src="//connect.facebook.net/en_US/fbevents.js";d=window.document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}window.fbq("init",a);window.fbq("track","PageView")}function e(b){return Number(b)&&a.isString(b)&&!a.isEmpty(b)}function f(a){return a.isUsingUrlFormat(b.siteConstants.URL_FORMATS.SLASH)}return{initRemarketingPixel:function(a,b){if(!e(b)){return}if(f(a)){d(b)}else{c(b)}},initPixelId:function(a,b){if(!e(b)||!f(a)){return}this.initRemarketingPixel(a,b)},fireRemarketingPixel:function(b,c,d){if(f(b)&&window.fbq&&a.isString(c)){window.fbq("track",c,d||{})}}}});define("loggingUtils/bi/services/googleRemarketing",["lodash"],function(a){"use strict";var b=false;var c={google_custom_params:{},google_remarketing_only:true};function d(d){if(b||!e(d)){return}a.assign(c,{google_conversion_id:d[0]});f();b=true}function e(b){return a.isArray(b)&&b.length===1&&Number(b[0])}function f(){var a=window.document.createElement("script");a.type="text/javascript";a.src="//www.googleadservices.com/pagead/conversion_async.js";a.async=true;a.setAttribute("onload","google_trackConversion("+JSON.stringify(c)+")");var b=window.document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}function g(){if(b&&window.google_trackConversion){window.google_trackConversion(c)}}return{initRemarketingPixel:d,fireRemarketingPixel:g}});define("loggingUtils/bi/services/yandexMetrika",["lodash"],function(a){"use strict";var b="yandex_metrika_callbacks";var c=false;var d;function e(b){return a.isArray(b)&&a.isFinite(parseInt(b[0],10))}function f(a){d="yaCounter"+a}function g(a){(window[b]=window[b]||[]).push(function(){try{window[d]=new window.Ya.Metrika(i(a))}catch(a){}})}function h(){if(!c){var a=window.document.getElementsByTagName("script")[0];var b=window.document.createElement("script");b.type="text/javascript";b.async=true;b.src="https://mc.yandex.ru/metrika/watch.js";b.addEventListener("load",function(){c=true});a.parentNode.insertBefore(b,a)}}function i(a){return{id:parseInt(a,10),clickmap:true,trackLinks:true,accurateTrackBounce:true,webvisor:true,trackHash:true}}return{initialize:function(a){if(!e(a)){return}f(a[0]);g(a[0]);h()},reportPageHit:function(b){if(!c){return}if(window[d]&&a.isFunction(window[d].hit)){window[d].hit(b)}}}});define("loggingUtils/bi/bi",["loggingUtils/bi/services/wixBI","loggingUtils/bi/services/googleAnalytics","loggingUtils/bi/services/facebookRemarketing","loggingUtils/bi/services/googleRemarketing","loggingUtils/bi/services/yandexMetrika"],function(a,b,c,d,e){"use strict";return{wixBI:a,googleAnalytics:b,facebookRemarketing:c,googleRemarketing:d,yandexMetrika:e}});define("loggingUtils/logger/newrelic",["lodash"],function(a){"use strict";if(typeof window!=="undefined"&&!(window.queryUtil&&window.queryUtil.isParameterTrue("suppressbi"))){var b;try{b=window.parent.newrelic}catch(a){b=window.newrelic}if(b){var c=window.performance&&window.performance.now?function(){return Math.round(window.performance.now())}:function(){return 0};return{setCustomAttribute:b.setCustomAttribute.bind(b),addPageAction:function(d,e){var f=c();e=a.assign({},e,{timeSinceNavigate:f});return b.addPageAction(d,e)},finished:function(){var a=c();if(a){this.setCustomAttribute("timeSinceNavigate",c())}return b.finished.apply(b,arguments)}}}}return{setCustomAttribute:a.noop,addPageAction:a.noop,finished:a.noop}});define("loggingUtils/logger/performance",["lodash","loggingUtils/logger/newrelic"],function(a,b){"use strict";var c=" start";var d=" finish";function e(){return-1}var f=typeof window!=="undefined"&&window.queryUtil;if(!f||f.isParameterTrue("suppressperformance")){return{mark:a.noop,measure:a.noop,start:a.noop,startOnce:a.noop,finish:a.noop,time:function(a,b){return b.apply(this,Array.prototype.slice.call(arguments,2))},getMark:a.noop,getMeasure:a.noop,clearMarks:a.noop,clearMeasures:a.noop,now:a.now,getResourceSize:e}}var g,h=window.performance;if(h&&h.now){g=h.now.bind(h)}else{var i=window.wixBiSession&&window.wixBiSession.initialTimestamp||0;g=function(){return a.now()-i}}var j=function(c,d){if(c){d=a.defaults({measureName:c.name,startTime:Math.round(c.startTime),duration:Math.round(c.duration)},d);b.addPageAction("measure",d)}};var k;if(h&&h.measure){var l=function(b,c){return a.find(h.getEntriesByName(c),{entryType:b})};k={mark:h.mark.bind(h),measure:function(a,b,c,d,e){try{h.measure(a,b,c);if(d){j(k.getMeasure(a),e)}}catch(a){}},getMark:l.bind(this,"mark"),getMeasure:l.bind(this,"measure"),clearMarks:h.clearMarks.bind(h),clearMeasures:h.clearMeasures.bind(h)}}else{var m={domLoading:{name:"domLoading",startTime:0}};var n={};var o=function(a,b){if(b){delete a[b]}else{a={}}};k={mark:function(a){m[a]={name:a,startTime:g()}},measure:function(a,b,c,d,e){var f=k.getMark(b);var g=k.getMark(c);if(f&&g){var h={name:a,startTime:f.startTime,duration:g.startTime-f.startTime};if(!isNaN(h.duration)){n[a]=h;if(d){j(h,e)}}}},getMark:function(a){return m[a]},getMeasure:function(a){return n[a]},clearMarks:o.bind(this,m),clearMeasures:o.bind(this,n)}}k.start=function(a){k.clearMeasures(a);k.mark(a+c)};k.startOnce=function(a){if(!k.getMark(a+c)){k.start(a)}};k.finish=function(a,b,e){var f=a+c;if(k.getMark(f)){var g=a+d;k.mark(g);k.measure(a,f,g,b,e);k.clearMarks(g);k.clearMarks(f)}return k.getMeasure(a)};k.time=function(a,b,c,d){try{k.start(a);return b.apply(this,Array.prototype.slice.call(arguments,4))}finally{k.finish(a,c,d)}};k.now=g;if(h&&window.performance.getEntriesByName){k.getResourceSize=function(b){var c=h.getEntriesByName(b);if(c&&c.length){var d=c[0];var e=d.transferSize||d.encodedBodySize;if(a.isNumber(e)){return e}}return-1}}else{k.getResourceSize=e}return k});define("loggingUtils/logger/beat",["lodash","loggingUtils/bi/bi","coreUtils","loggingUtils/logger/performance","experiment"],function(a,b,c,d,e){"use strict";var f=[];var g={};if(typeof window!=="undefined"&&window.wixBiSession){g=window.wixBiSession;g.beat(5)}var h={};var i=["No Site Type","WixSite","UGC","Template"];var j=["No Event Type","start","reset","finish"];var k="NO_SV";var l=2e3;var m={adapter:"bt",biUrl:"http://frog.wix.com/"};var n={src:29,evid:3};var o=["url","ref"];var p={6:"packages loaded",7:"load data",8:"render",finish:"layout",16:"TPAs"};var q={16:20};function r(b){if(a.isString(b)){var c=b.split(".");if(c.length>1){return c[1]}}return b}function s(b){var d=c.urlUtils.toQueryString(a.omit(b,o),true);return a.reduce(o,function(a,d){return a+"&"+c.urlUtils.toQueryParam(d,b[d],true)},d)}function t(b,c,d,e){var f=u(b);var g=v(b,d,e);var h={et:A(d)};return a.merge({},c,f,g,h)}function u(b){return{vuuid:x(),vid:k,dc:r(b.serviceTopology.serverName),vsi:h[b.siteId].viewerSessionId,uuid:b.siteHeader.userId,sid:b.siteId,iss:a.invoke(b,"isClientAfterSSR",false),msid:b.getMetaSiteId()}}function v(b,c,d){var e=y(b,c);var f=z(b,c,e);return{pid:d,pn:e,st:w(b),sr:C(),wr:D(),isjp:g.maybeBot?"1":"0",isp:b.isPremiumDomain(),url:B(b.currentUrl.full),ref:window.document.referrer,ts:f.ts,tts:f.tts,c:a.now(),v:b.baseVersion||"unknown"}}function w(b){var c=b.rendererModel.siteInfo.documentType;var d=a.indexOf(i,c);return d!==-1?d:c}function x(){var b=c.cookieUtils.getCookie("_wixUIDX")||"";b=b.slice(a.lastIndexOf(b,"|")+1);b=b.replace(/^(null-user-id|null)$/g,"");return b}function y(a,b){if(b==="start"){h[a.siteId].pageNumber++}return h[a.siteId].pageNumber}function z(b,c,e){var f=0;var g=0;if(c==="start"){h[b.siteId].lastTimeStamp=a.now()}else{f=a.now()-h[b.siteId].lastTimeStamp;g=e===1?Math.round(d.now()):f}return{ts:f,tts:g}}function A(b){var c=a.indexOf(j,b);if(c!==-1){return c}return b>3?b:-1}function B(a){return a.replace(/^http(s)?:\/\/(www\.)?/,"").substring(0,256)}function C(){var a=window.screen&&window.screen.width||0;var b=window.screen&&window.screen.height||0;return a+"x"+b}function D(){var a=0;var b=0;if(window.innerWidth){a=window.innerWidth;b=window.innerHeight}else if(window.document){if(window.document.documentElement&&window.document.documentElement.clientWidth){a=window.document.documentElement.clientWidth;b=window.document.documentElement.clientHeight}else if(window.document.body&&window.document.body.clientWidth){a=window.document.body.clientWidth;b=window.document.body.clientHeight}}return a+"x"+b}function E(a,b){g.et=b.et;a.wixBiSession.et=b.et}function F(a){return a>3&&a!==16}function G(a){var b=f[a];f[a]=true;return b}function H(a,b){return a&&a.wixBiSession.viewerSessionId&&a.viewMode!=="preview"&&!c.stringUtils.isTrue(a.currentUrl.query.suppressbi)&&A(b)!==-1&&(!F(b)||!G(b))}function I(a){h[a.siteId]=h[a.siteId]||{pageNumber:1,lastTimeStamp:a.wixBiSession.initialTimestamp||0,viewerSessionId:a.wixBiSession.viewerSessionId||c.guidUtils.getGUID()}}function J(a,b){var c={queryString:s(b),adapter:m.adapter,biUrl:a.getServiceTopologyProperty("biServerUrl")||m.biUrl};if(e.isOpen("beatNotBeacon")){c.useBeacon=false}return c}function K(b,c){var d=b.currentUrl.query.sampleratio;if(a.result(b,"isDebugMode",false)&&d!=="force"||d==="none"||!c){return true}return Math.floor(b.wixBiSession.random*c)===0}function L(a,c){if(K(a,q[c.et])){var d=J(a,c);b.wixBI.report(a,d)}}function M(a,b,c){var d=setTimeout(function(){d=0;c(b)},l);a.subSvSession(function(a){if(d){clearTimeout(d);b.vid=a||k;c(b)}})}var N;function O(a,b,c){I(a);var e=t(a,n,b,c);E(a,e);if(H(a,b)){M(a,e,L.bind(null,a))}if(!a.isViewerMode()){return}var f=a.viewMode;f=f==="site"?"":" "+f;if(!N){d.measure("main-r started"+f,"domLoading","beat 4",true);d.measure("utils loaded"+f,"beat 4","beat 5",true);N="beat 5"}var g="beat "+b;d.mark(g);var h=p[b]||b;d.measure(h+f,N,g,true);N=g}return{reportBeatEvent:O,shouldIncludeInSampleRatio:K}});define("loggingUtils/logger/logger",["lodash","loggingUtils/bi/bi","loggingUtils/logger/beat","coreUtils"],function(a,b,c,d){"use strict";var e=typeof window!=="undefined"&&window.queryUtil&&window.queryUtil.isParameterTrue("isEdited");var f=typeof window!=="undefined"&&!window.clientSideRender?4:3;var g=10;var h={errorName:"errn",errorCode:"errc",errc:"errc",src:"src",severity:"sev",sev:"sev",packageName:"errscp"};var i={recoverable:10,warning:20,error:30,fatal:40};var j={eventId:"evid",evid:"evid",src:"src"};var k={};function l(a){return typeof a==="string"?i[a]:a}function m(a){return{errn:a.errorName,evid:10,sev:l(a.severity),cat:e?1:2,iss:1,ut:d.cookieUtils.getCookie("userType")}}function n(b,c){var d=a.merge({src:44,sev:30,errn:"error_name_not_found"},w(b,h),m(b),v(b,c));if(c&&c.description){d.desc=JSON.stringify(c.description).slice(0,512)}return d}function o(b,c){return a.merge({src:42},w(b,j),v(b,c))}function p(b,c,d,e){var f;switch(c){case"error":f=n(d,e);break;case"event":f=o(d,e);break}return a.merge(f,t(b))}function q(a,b,c){var d=b.reportType||(b.errorCode||b.errc?"error":"event");var e={biUrl:a.serviceTopology.biServerUrl,adapter:b.adapter||b.endpoint||(d==="error"?"trg":"ugc-viewer"),params:p(a,d,b,c)};if("useBeacon"in b){e.useBeacon=b.useBeacon}return e}function r(b){return a.isFunction(b.getMetaSiteId)?b.getMetaSiteId():b.rendererModel.metaSiteId}function s(a){var b=a.santaBase&&a.santaBase.match(/([\d\.]+)\/?$/);return b&&b[1]||""}function t(b){k[b.siteId]=k[b.siteId]||b.wixBiSession.viewerSessionId||d.guidUtils.getGUID();var c=b.serviceTopology.serverName?a.head(b.serviceTopology.serverName.split(".")):"";var g={did:b.siteId,msid:r(b),majorVer:f,ver:s(b),server:c,viewMode:b.viewMode};if(!e){g.vsi=k[b.siteId]}return g}function u(a){return typeof a==="string"?encodeURIComponent(a):a}function v(b,c){var d={};var e=b.params;if(a.isArray(e)){d=a.pick(c,e)}else if(a.isObject(e)){d=a.mapValues(e,function(a){return u(c[a])})}else{d=a.mapValues(c,u)}return d}function w(b,c){return a.transform(b,function(a,b,d){var e=c[d];if(e){a[e]=b}},{})}function x(a){return d.stringUtils.isTrue(a.currentUrl.query.suppressbi)}function y(a){if(!a){return false}a.callCount=a.callCount||0;a.callCount++;return a.callLimit&&a.callCount>a.callLimit}function z(b,d){if(b.forceBI){return true}var e=g;if(d){if(a.result(b,"isWixSite",false)&&"wixSiteSampleRatio"in d){e=d.wixSiteSampleRatio}else if("sampleRatio"in d){e=d.sampleRatio}else if("errorCode"in d||d.endpoint==="editor"){e=0}}if(e&&e>=1){return c.shouldIncludeInSampleRatio(b,e)}return true}function A(a,b){return!x(a)&&!y(b)&&z(a,b)}function B(c,d,e){if(!c||!a.isObject(d)){return}if(A(c,d)){var f=q(c,d,e);b.wixBI.report(c,f)}}function C(a){return k[a.siteId]}function D(a,b){var c=[];var d=a.isPremiumDomain();switch(b){case"googleAnalytics":{if(E(a,b)){c.push(a.googleAnalytics)}break}case"facebookRemarketing":{if(E(a,b)&&d){c.push(a.facebookRemarketing)}break}case"googleRemarketing":{if(E(a,b)&&d){c.push(a.googleRemarketing)}break}case"yandexMetrika":{if(E(a,b)&&d){c.push(a.yandexMetrika)}break}}return c}function E(b,c){return!a.isEmpty(b[c])}function F(a){if(!e&&!x(a)){var c=D(a,"facebookRemarketing")[0];b.facebookRemarketing.initRemarketingPixel(a,c)}}function G(a,c){if(!e&&!x(a)){b.facebookRemarketing.initPixelId(a,c)}}function H(a,c,d){b.facebookRemarketing.fireRemarketingPixel(a,c,d)}function I(a){if(!e&&!x(a)){b.googleRemarketing.initRemarketingPixel(D(a,"googleRemarketing"))}}function J(){b.googleRemarketing.fireRemarketingPixel()}function K(a){if(!e&&!x(a)){b.yandexMetrika.initialize(D(a,"yandexMetrika"))}}function L(a){b.yandexMetrika.reportPageHit(a)}function M(c,d){if(c&&a.isString(d)&&!e&&!x(c)){b.googleAnalytics.reportPageEvent(c,d,D(c,"googleAnalytics"))}}function N(c){if(!e){var d=D(c,"googleAnalytics");b.googleAnalytics.report.apply(null,[d].concat(a.tail(arguments)))}}function O(b,c,d){a.forOwn(d,function(a){a.packageName=b})}return{reportBI:B,reportGoogleAnalytics:N,reportPageEvent:M,register:O,reportBeatEvent:c.reportBeatEvent,initFacebookRemarketingUserPixel:F,initFacebookRemarketingPixelId:G,fireFacebookRemarketingPixel:H,initGoogleRemarketingPixel:I,fireGoogleRemarketingPixel:J,initYandexMetrika:K,reportYandexPageHit:L,shouldSendReport:A,getVisitorId:C}});define("loggingUtils/bi/errors",["loggingUtils/bi/errors.json","lodash","loggingUtils/logger/logger"],function(a,b,c){"use strict";b.forEach(a,function(a,b){a.errorName=b});c.register("utils","error",a);return a});define("loggingUtils/log/log",["lodash","coreUtils"],function(a,b){"use strict";var c=console.log.bind(console);var d="DocumentServices|Deprecated|";var e=typeof window==="undefined"?true:b.urlUtils.parseUrl(a.get(window,["location","href"],"")).query.debug==="all";var f=e?c:a.noop;return{verbose:f,info:c,warn:console.warn.bind(console),error:console.error.bind(console),warnDeprecation:function(a){if(e){console.error.call(console,d+a)}}}});define("loggingUtils/logger/services/imageContext",["lodash","loggingUtils/logger/performance","experiment"],function(a,b,c){"use strict";var d=10;var e=10;var f={SUCCESS:0,FAIL:1};var g={INITIAL:0,PROGRESS:1,FINISHED:2};var h={INITIAL:0,SUCCESS_OR_FAIL:1,TIMED_OUT:2,DESTROYED:3};function i(){var a=parseInt(c.getValue("viewPortImageLoadingBi"),10);return a>0?a:5e3}var j={};var k=/\/(v[0-9.]+\/.+)$/;var l=/\/([^\/]+)$/;function m(b){if(a.isString(b)){var c=b.match(k);if(!c){c=b.match(l);if(!c){return""}}return c[1]}return""}function n(b,c,d){return a.filter(b,function(a){var b=a.id;if(!j[b]){j[b]={};j[b][c]=true;return true}return d&&!!j[b][c]})}function o(b,c,d){a.forEach(b,function(a){a.promise.then(c,d)})}function p(){this._contexts={};this._pageNumber=0}p.prototype={createImageContext:function(a,b,c,d){this._pageNumber++;return this._contexts[this._pageNumber]=new q({pageId:a,pageNumber:this._pageNumber},{onProgress:b,onSuccess:c,onFail:d})},getCurrentImageContext:function(){return this._contexts[this._pageNumber]}};function q(a,c){this._pageId=a.pageId;this._pageNumber=a.pageNumber;this._events=c;this._baseDuration=a.pageNumber===1?0:b.now();this._interval=0;this._finishCount=1;this._failDetailsBuffer=[];this._status=g.INITIAL;this._reason=h.INITIAL;this._images={total:0,success:0,fail:0,failDetails:[],totalSize:0}}q.prototype={_isFinished:function(){return this._images.total===this._images.success+this._images.fail},_isFinishSuccess:function(){return this._isFinished()&&this._images.fail===0},_checkFinished:function(){if(this._finishCount<=e&&this._isFinished()){this._finish(h.SUCCESS_OR_FAIL);if(this._isFinishSuccess()){this._events.onSuccess(this)}else{this._events.onFail(this)}this._finishCount++}},_startProgress:function(){var a=this;var b=1;this._status=g.PROGRESS;this._interval=setInterval(function(){a._flushFailDetailsBuffer();a._events.onProgress(a,b++);if(b>d){a._finish(h.TIMED_OUT)}},i())},_stopProgress:function(){if(this._interval){clearInterval(this._interval);this._interval=0}},_finish:function(a){this._status=g.FINISHED;this._reason=a;if(this._failDetailsBuffer.length){this._flushFailDetailsBuffer()}this._stopProgress()},_onImageStatusChange:function(a,c){if(this._status<g.PROGRESS||this._reason>h.SUCCESS_OR_FAIL){return}if(a===f.SUCCESS){var d=c.target?b.getResourceSize(c.target.src):0;this._increaseSuccessCount(d)}else{var e=c.target?m(c.target.src):"";this._increaseFailCount(e)}this._checkFinished()},_increaseSuccessCount:function(a){this._images.success++;this._images.totalSize+=a},_increaseFailCount:function(a){this._images.fail++;this._failDetailsBuffer.push({d:this.getDuration(),url:a})},_flushFailDetailsBuffer:function(){this._images.failDetails.push(this._failDetailsBuffer);this._failDetailsBuffer=[]},getImages:function(){return this._images},getPageId:function(){return this._pageId},getPageNumber:function(){return this._pageNumber},getDuration:function(){return Math.round(b.now()-this._baseDuration)},setImages:function(a){var b=n(a,this.getPageId(),this._status===g.INITIAL);this._images.total+=b.length;if(this._status===g.INITIAL){this._startProgress();this._checkFinished()}o(b,this._onImageStatusChange.bind(this,f.SUCCESS),this._onImageStatusChange.bind(this,f.FAIL));return this},destroy:function(){this._finish(h.DESTROYED)}};var r={_sites:{},get:function(a){return this._sites[a.siteId]=this._sites[a.siteId]||new p}};return{create:function(b,c,d,e,f){d=d||a.noop;e=e||a.noop;f=f||a.noop;return r.get(b).createImageContext(c,d.bind(null,b),e.bind(null,b),f.bind(null,b))},getCurrent:function(a){return r.get(a).getCurrentImageContext()}}});define("loggingUtils/logger/imagesBi",["lodash","loggingUtils/bi/bi","coreUtils","loggingUtils/logger/beat","loggingUtils/logger/services/imageContext"],function(a,b,c,d,e){"use strict";var f=8;function g(b){return JSON.stringify({a:a.take(b,f)})}function h(a,b){var d=b.getImages();var e=d.totalSize>=0?Math.round(d.totalSize/1024):"";return{src:29,d:b.getDuration(),tn:d.total,sid:a.siteId,msid:a.getMetaSiteId(),pid:b.getPageId(),pn:b.getPageNumber(),vsi:a.wixBiSession.viewerSessionId,vid:c.cookieUtils.getCookie("svSession"),s:e}}function i(b,d,e){var f=a.defaults(h(b,d),e);return{adapter:"m",queryString:c.urlUtils.toQueryString(f)}}function j(a,c,d){var e=c.getImages();b.wixBI.report(a,i(a,c,{evid:11,i:d,sn:e.success,fn:e.fail,fd:g(e.failDetails[d-1])}))}function k(a,c){b.wixBI.report(a,i(a,c,{evid:12}))}function l(c,d){var e=d.getImages();b.wixBI.report(c,i(c,d,{evid:13,fn:e.fail,fd:g(a.flatten(e.failDetails))}))}function m(a){return a.isViewerMode()&&d.shouldIncludeInSampleRatio(a)&&!c.stringUtils.isTrue(a.currentUrl.query.suppressbi)}return function(a,b){if(!m(a)){return}var c=a.getCurrentUrlPageId();var d=e.getCurrent(a);if(!d||d.getPageId()!==c){if(d){d.destroy()}d=e.create(a,c,j,k,l)}d=d.setImages(b);return d}});define("loggingUtils",["loggingUtils/bi/errors","loggingUtils/logger/logger","loggingUtils/log/log","loggingUtils/logger/performance","loggingUtils/logger/newrelic","loggingUtils/logger/imagesBi"],function(a,b,c,d,e,f){"use strict";var g={bi:{errors:a},logger:b,log:c,performance:d,newrelic:e,imagesBi:f};return g});