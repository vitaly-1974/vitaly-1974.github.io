define("dropDownMenu",["lodash","utils","core","santaProps","menuButton"],function(a,b,c,d,e){"use strict";var f=c.compMixins;function g(a){return!isNaN(parseFloat(a))&&isFinite(a)}function h(b){return a.filter(b,"isVisible")}function i(a,b,c,d,e,f){if(f===a.length-1){if(a.length===1){return"dropLonely"}if(b){return"bottom"}if(!c&&d!=="right"){return"center"}return e?"left":"right"}if(f===0){if(b){return"top"}if(!c&&d!=="left"){return"center"}return e?"right":"left"}return b?"dropCenter":"center"}function j(c,d,e,f,g){var h=a.some(e,["link.pageId.id",d]);var i;var j={AnchorLink:function(b){return(a.has(b.anchorDataId,"id")?b.anchorDataId.id:b.anchorDataId)===i},PageLink:function(a){if(!i){if(a.pageId.isPopup){return a.pageId.id===d}else if(!h){return a.pageId.id===c}}return false}};if(f){i=b.menuUtils.getActiveAnchorInPage(g,e,c)}return function(a){var b=a&&j[a.type];return b?b(a):false}}function k(b,c,d,e,f,g,h,k,l){return a.map(c,function(a,m){var n=a.link;var o=j(g,h,c,l,b);return{isContainer:Boolean(d),isSelected:o(n),positionInList:i(c,d,e,f,k,m)}})}return{displayName:"DropDownMenu",propTypes:a.assign({isMobileView:d.Types.isMobileView,isMobileDevice:d.Types.Device.isMobileDevice,isTabletDevice:d.Types.Device.isTabletDevice,anchorChangeEvent:d.Types.SiteAspects.anchorChangeEvent,currentUrlPageId:d.Types.Component.currentUrlPageId,currentPopupId:d.Types.currentPopupId,highlightAnchorsInMenu:d.Types.BrowserFlags.highlightAnchorsInMenu.isRequired,siteMenuWithRender:d.Types.Menu.siteMenuWithRender,nonHiddenPageIdsFromMainMenu:d.Types.Menu.nonHiddenPageIdsFromMainMenu,id:d.Types.Component.id,refInParent:d.Types.Component.refInParent,skin:d.Types.Component.skin,compProp:d.Types.Component.compProp,compData:d.Types.Component.compData},d.santaTypesUtils.getSantaTypesByDefinition(e)),statics:{useSantaTypes:true},mixins:[f.skinBasedComp,f.timeoutsMixin,f.skinInfo],getInitialState:function(){this.shouldChildrenUpdate=false;return{hover:null,hoverListPosition:null,activeAnchor:null,$dropAlign:this.props.compProp.alignButtons,$mobile:this.props.isMobileDevice||this.props.isMobileView||this.props.isTabletDevice?"mobile":"notMobile"}},componentDidMount:function(){if(this.props.highlightAnchorsInMenu){this.props.anchorChangeEvent.registerToAnchorChange(this)}},componentWillUnmount:function(){if(this.props.highlightAnchorsInMenu){this.props.anchorChangeEvent.unregisterToAnchorChange(this)}},convertItemsToChildren:function(b,c,d,e){var f=h(b);c=c||{};c.style=c.style||{};var g=k(this.props.anchorChangeEvent,f,e,this.props.compProp.stretchButtonsToMenuWidth,this.props.compProp.alignButtons,this.props.currentUrlPageId,this.props.currentPopupId,this.props.compProp.rtl,this.props.highlightAnchorsInMenu);return a.map(f,function(b,d){var f=(e?"moreContainer":"")+d;return this.createChildComponent(b,"core.components.MenuButton","repeaterButton",a.merge({isContainer:g[d].isContainer,isSelected:g[d].isSelected,positionInList:g[d].positionInList,id:this.props.id+f,ref:f,key:b.id,refInParent:f,mouseEnterHandler:this.mouseEnterHandler,mouseLeaveHandler:this.mouseLeaveHandler,isDropDownButton:e,onMouseClick:this.onMouseClick},c))}.bind(this))},onMouseClick:function(a,b,c){var d=h(this.props.siteMenuWithRender);if(!c){var e=[];if(b!=="__more__"){var f=d[b].items;e=h(f)}var g=e.length>0||b==="__more__";var i=this.state.hover;if(!this.dropDownOpen&&g){this.mouseEnterHandler(b);a.preventDefault();a.stopPropagation()}else if(this.dropDownOpen&&!this.isDropdownOwner(b,i)&&g){this.mouseLeaveHandler();a.preventDefault();a.stopPropagation();this.mouseEnterHandler(b)}else if(this.dropDownOpen){this.mouseLeaveHandler()}}else{this.mouseLeaveHandler()}},onAnchorChange:function(a){if(a!==this.state.activeAnchor){this.setState({activeAnchor:a})}},isDropdownOwner:function(a,b){return a===b},createMoreButton:function(a){var b="__more__";var c=a?"left":"right";var d=this.props.compProp.alignButtons;var e=this.props.compProp.stretchButtonsToMenuWidth;if(!e&&d!=="right"){c="center"}return this.createChildComponent({id:b,label:this.props.compProp.moreButtonLabel},"core.components.MenuButton","repeaterButton",{isSelected:false,positionInList:c,id:this.props.id+b,ref:b,key:b,mouseEnterHandler:this.mouseEnterHandler,mouseLeaveHandler:this.mouseLeaveHandler,onMouseClick:this.onMouseClick,isDropDownButton:false,display:"inline-block"})},mouseEnterHandler:function(a,c){this.hovering=true;this.lastHovered=this.getCurrentTime();var d=a.replace(this.props.id,"");var e=this.props.nonHiddenPageIdsFromMainMenu.concat("__more__");var f=e.indexOf(d);if(f!==-1&&(g(d)||b.stringUtils.startsWith(a,"__"))&&a!==this.state.hover){if(this.state.hover){this.refs[this.state.hover].setIdleState()}this.registerReLayout();this.setState({hover:a,hoverListPosition:c})}},getCurrentTime:function(){return Date.now()},mouseLeaveHandler:function(){this.hovering=false;this.lastHovered=this.getCurrentTime();if(!this.dropDownOpen&&this.state.hover){this.refs[this.state.hover].setIdleState()}this.setTimeout(function(){var a=this.getCurrentTime()-this.lastHovered;if(!this.hovering&&this.state.hover&&a>=1e3){this.refs[this.state.hover].setIdleState();this.dropDownOpen=false;this.setState({hover:null,hoverListPosition:null})}}.bind(this),1e3)},getParamsFromSkins:function(){return{menuBorderY:this.getSumParamValue("menuTotalBordersY",this.props.skin),menuBtnBorder:this.getSumParamValue("menuButtonBorders",this.getSkinExports().repeaterButton.skin),ribbonEls:this.getParamFromDefaultSkin("ribbonEls").value?parseInt(this.getParamFromDefaultSkin("ribbonEls").value,10):0,labelPad:this.getFromExports("labelPad"),ribbonExtra:this.getFromExports("ribbonExtra")?Math.abs(parseInt(this.getFromExports("ribbonExtra"),10)):0}},getSkinProperties:function(){var a=h(this.props.siteMenuWithRender);var b=this.getParamsFromSkins();var c=this.convertItemsToChildren(a,{display:"inherit"},null,null);var d=[];var e="hidden";c.push(this.createMoreButton(this.props.compProp.rtl));if(this.props.compProp.rtl){c.reverse()}if(g(this.state.hover)||this.state.hover==="__more__"){d=this.convertItemsToChildren(g(this.state.hover)?a[this.state.hover].items:a,{style:{width:"100%"},display:"block",prefix:"_",subMenu:true},true,true);if(d.length>0){e="inherit";this.dropDownOpen=true}}return{"":{id:this.props.id,key:this.props.refInParent,ref:this.props.refInParent,"data-menuborder-y":b.menuBorderY,"data-menubtn-border":b.menuBtnBorder,"data-ribbon-els":b.ribbonEls,"data-label-pad":b.labelPad,"data-ribbon-extra":b.ribbonExtra,"data-drophposition":this.state.hover?this.state.hoverListPosition:"","data-dropalign":this.props.compProp.alignButtons},itemsContainer:{children:c,style:{textAlign:this.props.compProp.alignButtons}},moreContainer:{children:d,"data-hover":this.state.hover,style:{visibility:e}},dropWrapper:{style:{visibility:e},"data-drophposition":this.state.hover?this.state.hoverListPosition:"","data-dropalign":this.props.compProp.alignButtons}}}}});