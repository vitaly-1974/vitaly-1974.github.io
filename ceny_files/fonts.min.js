define("fonts/utils/fontUtils",["lodash","utils","coreUtilsLib"],function(a,b,c){"use strict";var d=c.fonts;var e="//fonts.googleapis.com/css?family=";var f=["latin-ext","cyrillic","japanese","korean","arabic","hebrew","latin"];var g=/<[^>]+class="[^"]*(font_[0-9]+)[^"]*"/g;var h={StyledText:function(a,b){return[b.text]},RichText:function(a,b){return[b.text]}};function i(a,b){h[a]=b}var j={};function k(a,b){j[a]=b}function l(a){return b.cssUtils.parseFontStr(a)}function m(b){return a.compact(a.map(b,function(a){return d.getFontsMetaData()[a]}))}function n(b){return a(b).split(",").invokeMap("replace",/.*[^\w\d\-].*/,'"$&"').join(",")}function o(a){var b=d.getFontsMetaData()[a.toLowerCase()];var c=b.fontFamily,e;if(b){e=c;if(b.fallbacks!==""){e+=","+b.fallbacks}e+=","+b.genericFamily}else{e=a}return n(e)}function p(b,c){if(b.length===0){return undefined}var d=a.map(b,function(a){return a.cdnName+":n,b,i,bi|"});if(c){d.push("&subset=");d.push(c.join(","))}return e+d.join("")}function q(b,c){var e=a.filter(r(b,c),function(b){return a.has(d.getFontsMetaData(),b)});return m(e)}function r(a,b){return t(a,b)}function s(b){var c=a.times(11,function(a){return"font_"+a});return u(b,c)}function t(c,d){var e=c.getPageData(d).data.document_data;var f=a(e).filter(function(b){return a.has(h,b.type)}).map(function(d){var e=h[d.type](c,d);return a.union(b.fonts.fontsParser.collectFontsFromTextDataArray(e))}).flattenDeep().value();var g=a(e).filter(function(b){return a.has(j,b.type)}).map(function(a){return j[a.type](c,a)||[]}).flattenDeep().value();var i=a.get(e,"masterPage.usedFonts",[]);return a.union(f,g,s(c),i)}function u(b,c){var d=b.getGeneralTheme();return a.map(c,function(a){return v(d,a)})}function v(a,b){var c=a.font;var d=parseInt(b.substring(b.indexOf("_")+1),10);var e=c[d];var f="";if(e){f=l(e).family.toLowerCase()}return f}function w(b){var c=F(b.serviceTopology,b.rendererModel.siteInfo.documentType);return a.values(c)}function x(b,c){var d=z(b);return a(f).intersection(c).map(function(a){return{lang:a,fonts:d[a]}}).value()}function y(a){return x(a.rendererModel.siteInfo.documentType,a.getDataByQuery("masterPage").characterSets)}function z(b){var c=B(b);var e=a.reduce(d.getFontsMetaData(),function(b,d,e){var f=d.characterSets;if(a.includes(c,d.permissions)){d.cssFontFamily=o(e);a.forEach(f,function(a){if(!b[a]){b[a]=[]}b[a].push(d)})}return b},{});a.forOwn(e,function(b,c){e[c]=a.sortBy(b,"displayName")});return e}function A(b,c,d){var f=a.isArray(b)?b:a.keys(b);var g=C(f,c,d);if(g){return e+g}return""}function B(a){var b=["all","legacy"];if(a==="WixSite"){b.push("studio")}return b}function C(b,c,e){var f="";var g=B(c);a.forEach(b,function(b){var c=d.getFontsMetaData()[b];if(c&&c.cdnName&&a.includes(g,c.permissions)){f+=c.cdnName;f+=":n,b,i,bi|"}});if(f===""){return null}if(e){f+="&subset="+e.join(",")}return f}function D(a){g.lastIndex=0;var b=g.exec(a);return b?b[1]:undefined}function E(a){return a.publicStaticsUrl+"/css/Helvetica/fontFace.css"}function F(a,c){var d={langauges:b.media.getMediaUrl(a,"user-site-fonts/v3/languages.css")};if(c==="WixSite"){d.helveticas=b.media.getMediaUrl(a,"user-site-fonts/v3/helvetica.css")}return d}function G(b,c){var e={};e.googleFonts=A(d.getFontsMetaData(),b,f);a.merge(e,F(c,b));return e}return{parseFontStr:d.parseFontStr,parseStyleFont:d.parseStyleFont,getMetadata:m,getGoogleFontsUrl:p,getFontFamily:d.getFontFamily,getFontFallback:d.getFontFallback,getPageFontsMetaData:q,getFontFamilyWithFallbacks:d.getFontFamilyWithFallbacks,getWixStoredFontsCssUrls:w,getWixStoredFontsCssUrlsWithParams:d.getWixStoredFontsCssUrlsWithParams,getCurrentSelectablefonts:y,getCurrentSelectablefontsWithParams:x,collectFontsFromTextDataArray:b.fonts.fontsParser.collectFontsFromTextDataArray,getFontsUrlWithParams:d.getFontsUrlWithParams,getFontFamilyByStyleId:v,getFontClassName:D,registerCustomTextDataGetter:i,registerCustomFontFamiliesGetter:k,getPageUsedFontsList:r,getWixHelveticaUrl:E,getCssUrls:G,fontToCSSWithColor:d.fontToCSSWithColor,getFontFamilyPermissions:d.getFontFamilyPermissions,POSSIBLE_CHARACTERS_SETS:f}});define("fonts/utils/fontCss",["lodash","fonts/utils/fontUtils"],function(a,b){"use strict";function c(a){var c=a;var d=b.getFontFallback(a);if(d){c=c+","+d}c=c.replace(/[^,]*[^\w,\d\-][^,]*/g,function(a){return"'"+a.replace(/\+/g," ")+"'"});return c}function d(d){var e=d;if(a.includes(e,"#")){e=e.slice(0,e.indexOf("#"))}e=e.replace(/\{color_\d+\}/,"");var f=b.getFontFamily(e);var g=c(f);var h=e.replace(f,g);return h+";"}function e(b,c){if(a.startsWith(b,"font_")){var d=b.split("font_");if(d.length===2){return c.font[d[1]]}}return b}function f(a,b){var c=e(a,b);return d(c)}function g(c,d){var e="";a.forEach(c,function(a,c){e+=".font_"+c+" {font: "+b.fontToCSSWithColor(a,d)+"} \n"});return e}return{fontToCSSWithoutColor:f,getThemeFontsCss:g,getFullFontFamily:c}});define("fonts/utils/fontsTracker",["lodash","fonts/utils/fontUtils"],function(a,b){"use strict";var c={permissions:"all",provider:"monotype"};var d=Object.create(null);function e(e,g){if(!a.isObject(e)){return false}d.masterPage=d.masterPage||f(e,"masterPage");d[g]=d[g]||f(e,g);var h=a.union(d.masterPage,d[g]);var i=b.getMetadata(h);return a.some(i,{permissions:c.permissions,provider:c.provider})}function f(a,c){return b.getPageUsedFontsList(a,c)}return{shouldTrackFonts:e}});define("fonts",["fonts/utils/fontUtils","fonts/utils/fontCss","fonts/utils/fontsTracker","coreUtilsLib"],function(a,b,c,d){"use strict";return{fontUtils:a,fontCss:b,fontMetadata:d.fonts.getFontsMetaData(),uplodedFontsUtils:{isUploadedFontFamily:d.fonts.isUploadedFontFamily,getUploadedId:d.fonts.getUploadedId,getUploadedFontFaceStyles:d.fonts.getUploadedFontFaceStyles,getUploadedFontValue:d.fonts.getUploadedFontValue},fontsTracker:c}});