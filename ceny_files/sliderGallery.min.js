define("sliderGallery",["lodash","react","reactDOM","coreUtils","siteUtils","core","skins","santaProps","galleriesCommon","displayer"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=f.compMixins;var l=i.utils.galleriesHelperFunctions;var m=d.matrix.scalingCalculations;function n(a,b,c){var d=this.state.currentIndex;if(d!==a){if(this.props.onImageSelected){b.type="imageSelected";b.payload={itemIndex:a,imageData:this.props.compData.items[a]};this.props.onImageSelected(b,c)}this.setState({currentIndex:a})}}var o=60;function p(b,c){var d=c.props.selectedItemIndex||0;var e=a.get(b,["currentIndex"],d);return{currentIndex:e}}return{displayName:"SliderGallery",statics:{useSantaTypes:true,behaviors:{nextSlide:{methodName:"next"},prevSlide:{methodName:"prev"}}},mixins:[k.skinBasedComp,k.skinInfo,k.animationsMixin,k.timeoutsMixin,k.compStateMixin(p)],propTypes:a.assign({id:h.Types.Component.id.isRequired,rootId:h.Types.Component.rootId.isRequired,compData:h.Types.Component.compData.isRequired,compProp:h.Types.Component.compData.isRequired,skin:h.Types.Component.skin.isRequired,style:h.Types.Component.style.isRequired,isMobileView:h.Types.isMobileView,isMobileDevice:h.Types.Device.isMobileDevice,isTabletDevice:h.Types.Device.isTabletDevice,windowTouchEventsAspect:h.Types.SiteAspects.windowTouchEvents.isRequired,getSliderGalleryMeasures:h.Types.__DangerousSantaTypes.getSliderGalleryMeasures,onImageSelected:b.PropTypes.func},h.santaTypesUtils.getSantaTypesByDefinition(j)),_currentOffset:null,_motion:false,_firstChild:null,getInitialState:function(){this.props.windowTouchEventsAspect.registerToWindowTouchEvent("touchStart",this);return a.assign(p(null,{props:this.props.compProp}),{$mobile:this.props.isMobileDevice||this.props.isTabletDevice?"mobile":"notMobile",$displayDevice:this.props.isMobileView?"mobileView":"desktopView"})},componentWillUnmount:function(){this.props.windowTouchEventsAspect.unregisterFromWindowTouchEvent("touchStart",this)},getSkinProperties:function(){this.gap=a.isNumber(this.props.compProp.margin)?this.props.compProp.margin:20;this.contentOverflow=false;var b=g.skins[this.props.skin];var c=b.exports&&b.exports.bottomGap||0;var d=Math.abs(this.getFromExports("itemContainerAdditionalHeight"));var e=this.populate(c,d);var f=Math.abs(this.getFromExports("itemContainerTotalOffset"));var h=this.props.style.width-f;if(this.itemsHolderWidth>h){this.contentOverflow=true;e=this.populate(c,d)}return{imageItem:{},images:{children:e,"data-gallery-id":this.props.id},swipeLeftHitArea:{onMouseEnter:this.prev,onMouseLeave:this._stopMovement,onTouchStart:this.prev,"data-gallery-id":this.props.id},swipeRightHitArea:{onMouseEnter:this.next,onMouseLeave:this._stopMovement,onTouchStart:this.next,"data-gallery-id":this.props.id},"":{onSwipeLeft:this.next,onSwipeRight:this.prev,"data-height-diff":l.getSkinHeightDiff(this.props.skin),"data-width-diff":l.getSkinWidthDiff(this.props.skin),"data-bottom-gap":c,"data-additional-height":d}}},getChildrenData:function(){var a=this.props.compData.items;return this.props.compProp.loop&&this.contentOverflow?a.concat(a):a},populate:function(b,c){var d;var e=this.props.compProp;var f=this.props.compData;this.itemsHolderWidth=0;var h=this.getChildrenData();d=h.map(function(d,h){var i=d;var j=this.getSkinExports().imageItem.skin;var k=this.getParams(["topPadding","imgHeightDiff"],j);var o=l.getDisplayerHeightDiff(g.skins[j],k,this.state.$displayDevice);var p=l.getDisplayerWidthDiff(g.skins[j],this.state.$displayDevice);var q=Math.floor(this.props.style.height+c);var r=this.props.compData.items.length;var s=m.getSizeAfterScaling({itemHeight:q,itemWidth:Math.floor(q*(this.props.compProp.aspectRatio||1)),displayerData:i,imageMode:this.props.compProp.imageMode,heightDiff:o,widthDiff:p,bottomGap:b});this.itemsHolderWidth=this.itemsHolderWidth+s.imageWrapperSize.imageWrapperWidth+this.gap;return this.createChildComponent(i,"wysiwyg.viewer.components.Displayer","imageItem",{rootId:this.props.rootId,currentUrlPageId:this.props.currentUrlPageId,rootNavigationInfo:this.props.rootNavigationInfo,galleryDataId:f.id,imageWrapperSize:s.imageWrapperSize,style:{display:"inline-block",margin:"0 "+(a.isNumber(e.margin)?e.margin:20)+"px 0 0",height:s.displayerSize.height,width:s.displayerSize.width},isSelected:this.state.currentIndex===h,onClick:n.bind(this,h),displayerDataQuery:d,galleryId:this.props.id,heightDiff:o,widthDiff:p,bottomGap:b,imageIndex:h%r,key:this.props.id+i.id+"_"+h,ref:"displayer"+h,id:this.props.id+"displayer"+h})},this);return d},prev:function(){this._move(true)},next:function(){this._move(false)},_move:function(a){var b=this.props.compProp.maxSpeed||.05;this.slide(a,b,this.props.compProp.loop)},_stopMovement:function(){if(this._sequenceId){this.easeStopSequence(this._sequenceId,1);this._sequenceId=null}},slide:function(a,b,d){if(!this.contentOverflow){return}var f=this.props.getSliderGalleryMeasures(this.props.id);var g=f.imagesWidth-(this.props.compProp.margin||0);var h=f.itemsContainerWidth;var i=c.findDOMNode(this.refs.images).offsetLeft;var j=d?-g/2:h-g;this._stopMovement();var k=this.sequence();var l=Math.abs(j)/(b*o);var m=l*(a?Math.abs(i/j):1-Math.abs(i/j));k.add("images","BasePosition",m,0,{from:{left:i},to:{left:a?0:j},ease:"Linear.easeNone"});if(d){k.add("images","BasePosition",l,0,{from:{left:a?j:0},to:{left:a?0:j},repeat:d?-1:0,immediateRender:false,ease:"Linear.easeNone"})}k.onCompleteAll(function(){var a=this.props.compData.items[this.state.currentIndex];this.handleAction(e.constants.ACTION_TYPES.IMAGE_CHANGED,{id:a})}.bind(this));this._sequenceId=k.execute({paused:true});this.easeStartSequence(this._sequenceId,1);if(this.state.$mobile==="mobile"){this.clearTimeoutNamed(this.props.id);this._nextStopTimeout=this.setTimeoutNamed(this.props.id,function(){this._stopMovement()}.bind(this),2e3)}},onWindowTouchStart:function(a){var b=a.target.getAttribute("data-gallery-id")||a.target.parentNode.getAttribute("data-gallery-id");if(b!==this.props.id){this._stopMovement()}}}});