define("wixCodeInit/utils/urlBuilder",[],function(){"use strict";function a(){var a=arguments[0];for(var b=1;b<arguments.length;++b){a=a.replace(/\/$/,"")+"/"+arguments[b].replace(/^\//,"")}return a}function b(a){return/^https?:\/\/localhost\/?$/.test(a)}function c(a){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/SNAPSHOT\/santa?$/.test(a)}function d(a){return/^\d+\.\d+\.\d+$/.test(a)}function e(a,b){var c=a.lastIndexOf("/");return d(b)?a.substring(0,c+1)+b:a}function f(a,d){var f=a.serviceTopology;var g=b(a.santaBase)||c(a.santaBase)?f.scriptsLocationMap.santa:a.santaBase;g=e(g,d);return/(.*\/services\/)?(.*)/.exec(g)[2]}function g(b,c,d){var e="//"+c.instanceId+".";var g=b.serviceTopology.wixCloudBaseDomain;var h="node_modules/santa-wix-code/index.html";var i=f(b,d);return e+a(g,"_partials",i,h)}function h(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}function i(a,b,c){c=c||{};var d=g(a,b,c.runtimeSource);var e=!!a.publicModel;var f={compId:"wixCode_"+b.appDefinitionId,deviceType:c.isMobileView?"mobile":"desktop",viewMode:e?"site":a.renderFlags.componentViewMode||"preview",instance:b.instance,locale:a.rendererModel.languageCode};if(c.sdkSource){f.sdkSource=c.sdkSource}if(c.applications){f.applications=JSON.stringify(c.applications)}if(c.ReactSource){f.ReactSource=c.ReactSource}var i=h(f);return d+"?"+i}return{buildUrl:i}});define("wixCodeInit/utils/messageHolder",[],function(){"use strict";function a(){var a=[];var b=null;return{sendOrHoldMessage:function(c){if(!b){a.push(c)}else{b(c)}},setMessageTarget:function(c){b=c;while(a.length>0){b(a.shift())}}}}return{get:a}});define("wixCodeInit/utils/iFrameUtils",[],function(){"use strict";function a(a,b){var c=window.document.createElement("iframe");c.style.display="none";c.src=a;c.className="wix-code-app";c.setAttribute("data-app-id",b.applicationId);c.setAttribute("data-app-definition-id",b.appDefinitionId);return c}function b(a,b){return b.source===a.contentWindow}return{getIFrameForApp:a,isIFrameEvent:b}});define("wixCodeInit/utils/appsUtils",["lodash"],function(a){"use strict";function b(b,c){var d;a.forEach(c,function(a){var c=b.getDynamicPageData(a);if(c){d=c}});return d}function c(c,d,e){if(!c){return}var f=b(c,e);if(!f){return}var g=f.routerData;var h=f.routerDefinition;if(!g||!h){return}var i=h.appDefinitionId==="wix-code";if(i){a.forEach(e,function(b){a.forEach(d,function(a){if(a.id===b){a.routerData=g}})})}else{var j=a.find(d,{id:h.appDefinitionId});if(j){j.routerData=g}}}function d(b){var c={displayName:"siteextension"};return a(b).reject(c).map(function(b){return a.assign({type:e.APPLICATION},b)}).value()}var e={POPUP:"Popup",PAGE:"Page",MASTER_PAGE:"masterPage",APPLICATION:"Application"};function f(b,c,d,f,g){if(a.find(b,c)){var h=f.isPlatformAppOnPage("masterPage","wixCode");a.forEach(d,function(a){var b=f.isPlatformAppOnPage(a,"wixCode");var c=f.getDataByQuery(a);var d=c.isPopup;if(b){g.push({id:a,type:d?e.POPUP:e.PAGE,displayName:f.getPageTitle(a)})}if(!d&&h){g.push({id:a,type:e.MASTER_PAGE})}})}}function g(b,e,g){b=a.without(b,"masterPage");var h={displayName:"siteextension"};var i=d(g);f(g,h,b,e,i);c(e,i,b);return i}function h(){var a=arguments[0];for(var b=1;b<arguments.length;++b){a=a.replace(/\/$/,"")+"/"+arguments[b].replace(/^\//,"")}return a}function i(a,b,c){var d=h(a.scriptsDomainUrl,"services",b);if(c){return h(d,c)}return a.scriptsLocationMap[b]}function j(b,c,d){if(a.get(b,"port")&&a.get(b,"path")&&a.get(b,"id")){d=a.endsWith(d,"/")?d.slice(0,-1):d;var f=a.template("<%= santaBase %><%= port %>/<%= path %>");var g;if(b.port==="80"){g=f({santaBase:d,port:"",path:b.path})}else{g=f({santaBase:d,port:":"+b.port,path:b.path})}c.push({type:e.APPLICATION,id:b.id,url:g,displayName:b.id})}}function k(b,c,d,f){if(a.find(b,{type:"siteextension"})&&!a.find(c,{id:"dataBinding"})){c.push({type:e.APPLICATION,id:"dataBinding",url:h(i(d,"dbsm-viewer-app",f.dataBinding),"/app.js"),displayName:"Data Binding"})}}function l(b){return a(b).filter(function(b){return b.type==="siteextension"||a.get(b,"platformApp.viewerUrl")}).map(function(b){var c={id:b.appDefinitionId,displayName:b.type,appInnerId:b.applicationId};var d=a.get(b,"platformApp.viewerUrl");if(d){c.url=d}return c}).value()}function m(a){var b=l(a.clientSpecMap);var c=p(a.viewerPlatformAppSources);j(c,b,a.santaBase);k(a.clientSpecMap,b,a.serviceTopology,c);return b}function n(b){var c=m(b);return a.filter(d(c),"url")}function o(b,c,d){var e=a.get(d,["currentUrl","query","viewerPlatformAppSources"]);var f=m({clientSpecMap:b,viewerPlatformAppSources:e,serviceTopology:d.serviceTopology,santaBase:d.santaBase});return g(c,d,f)}function p(b){return a(b||"").split(",").invokeMap("split",":").fromPairs().value()}function q(b,c,d){return a.reject(o(b,c,d),{type:e.APPLICATION})}return{getApplications:o,getUserCodeDefinitions:q,getAppsBaseInfo:n}});define("wixCodeInit/utils/widgetsPreLoader",["wixCodeInit/utils/appsUtils"],function(a){"use strict";var b=null;var c=null;var d=null;var e=[];function f(a,f,g,h){if(k()){e.push([a,f,g,h]);requirejs(["utils","widgets","wixCode"],j);return}var i=h(b);i.currentUrl=b.urlUtils.parseUrl(a);var l=b.wixUrlParser.parseUrl(i,a);var m=l&&l.pageId;if(!m){return}var n=f(c,i,m);var o=d.wixCodeWidgetService.getWixCodeSpec(i.rendererModel.clientSpecMap);var p=d.messageBuilder.getExtendedMessage(n,i.rendererModel.wixCodeModel||{},o,i);g(p)}function g(b,c,d){var e=function(a){return new a.FullSiteData(b,function(){})};var g=function(c,d,e){var f=a.getApplications(b.rendererModel.clientSpecMap,[e],d);var g=b.routers||{configMap:{}};return c.messageBuilder.loadWidgetsMessage(f,g.configMap,[e])};f(c,g,d,e)}function h(b,c,d){var e=function(c,d,e){var f=a.getUserCodeDefinitions(b.rendererModel.clientSpecMap,[e],d);return c.messageBuilder.loadUserCodesMessage(f,[e])};var g=function(a){return new a.FullSiteData(b,function(){})};f(c,e,d,g)}function i(a,b,c){var d=function(a,b,c){var d={};d[c]=a.widgetService.getControllersToInit(b,c);return a.messageBuilder.initWidgetsMessage(d)};var e=function(){return a};f(b,d,c,e)}function j(a,g,h){if(k()){b=a;c=g;d=h;for(var i=0;i<e.length;i++){f.apply(null,e[i])}e.length=0}}function k(){return!b||!c||!d}return{asyncGetPreLoadMessage:g,asyncGetPreLoadUserCodeMessage:h,asyncGetPreInitMessage:i,registerDeps:j}});define("wixCodeInit/utils/specMapUtils",[],function(){"use strict";var a="siteextension";function b(b){for(var c in b){if(b.hasOwnProperty(c)&&b[c].type===a){return b[c]}}}return{getAppSpec:b}});define("wixCodeInit/api/wixCodeAppApi",["wixCodeInit/utils/urlBuilder","wixCodeInit/utils/messageHolder","wixCodeInit/utils/iFrameUtils","wixCodeInit/utils/widgetsPreLoader","wixCodeInit/utils/specMapUtils"],function(a,b,c,d,e){"use strict";function f(a){return a.intent==="WIX_CODE"&&a.type==="wix_code_iframe_loaded"}function g(a){return a.intent==="WIX_CODE_SITE_API"&&a.type==="reportBI"}function h(a){if(window.document.readyState!=="loading"){window.document.body.appendChild(a)}else{window.document.addEventListener("DOMContentLoaded",function(){window.document.body.appendChild(a)})}}function i(){var i=[];var j=[];var k=b.get();var l=false;var m=true;var n=null;var o=null;var p=null;function q(a,b){if(!c.isIFrameEvent(a,b)){return}if(f(b.data)){k.setMessageTarget(function(b){a.contentWindow.postMessage(b,"*")})}if(g(b.data)&&!i.length&&typeof window!=="undefined"){var d=b.data.reportDef;var e=b.data.params;if(d.errorCode){window.wixBiSession.sendError(d,e.p1,e.p2,e.p3,e.p4)}else{window.wixBiSession.sendBI(d.endpoint,d.eventId,d.src,e)}}i.forEach(function(a){a(b.data)})}function r(b,d,f){if(l){console.warn("Wix code is already initiated");return}var g=e.getAppSpec(d);if(g){var i=a.buildUrl(b,g,f);var j=c.getIFrameForApp(i,g);var k=q.bind(null,j);window.addEventListener("message",k,false);h(j);l=true}}function s(a){i.push(a)}function t(a){j.push(a)}function u(a){var b=a;j.forEach(function(a){b=a(b)});return b}function v(a){if(a){k.sendOrHoldMessage(u(a))}}function w(a,b){var c=e.getAppSpec(a.rendererModel.clientSpecMap);if(!n&&c){d.asyncGetPreLoadMessage(a,b,function(a){if(m&&!n){n=a;k.sendOrHoldMessage(n)}})}}function x(a,b){var c=e.getAppSpec(a.rendererModel.clientSpecMap);if(!o&&c){d.asyncGetPreLoadUserCodeMessage(a,b,function(a){if(!o){o=a;k.sendOrHoldMessage(o)}})}}function y(a,b){var c=e.getAppSpec(a.rendererModel.clientSpecMap);if(!p&&c){d.asyncGetPreInitMessage(a,b,function(a){if(!p){p=a;k.sendOrHoldMessage(p)}})}}return{init:r,sendMessage:v,registerMessageHandler:s,registerMessageModifier:t,preLoadWidgets:w,preLoadUserCode:x,preInitWidgets:y}}return{getApi:i}});define("wixCodeInit/api/initMainR",["lodash","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils"],function(a,b,c){"use strict";function d(d,e,f,g,h){h=h||window.document.location.href;var i=a.trimEnd(e.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"/")+"/lib/wix.min.js";var j={isMobileView:f,sdkSource:g.getParameterByName("sdkSource")||i,runtimeSource:g.getParameterByName("WixCodeRuntimeSource"),ReactSource:g.getParameterByName("ReactSource")};var k=g.getParameterByName("viewerPlatformAppSources");j.applications=c.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,viewerPlatformAppSources:k,santaBase:e.santaBase});function l(a){return b.getAppSpec(a)||j.applications.length}function m(a){d.init(e,a,j);if(l(a)){d.preLoadUserCode(e,h);var b=!!e.publicModel;if(b){d.preLoadWidgets(e,h)}}}m(e.rendererModel.clientSpecMap)}return d});define("wixCodeInit",["wixCodeInit/api/wixCodeAppApi","wixCodeInit/api/initMainR","wixCodeInit/utils/specMapUtils","wixCodeInit/utils/appsUtils","wixCodeInit/utils/widgetsPreLoader"],function(a,b,c,d,e){"use strict";return{getAppApi:a.getApi,initMainR:b,specMapUtils:c,appsUtils:d,registerDeps:e.registerDeps}});